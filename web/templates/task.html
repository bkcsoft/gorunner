{{ define "title" }}{{ .Name }}{{ end }}

{{ define "head" }}
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/codemirror/2.36.0/codemirror.min.css">
{{end}}

{{ define "navigation" }}
{{ template "nav" "Task"}}
	<li class="nav-header">Actions</li>
	<li><a href="#" id="delete-task">Delete Task</a></li>
{{ end }}

{{ define "content" }}
	<h1>{{ .Name }}</h1>
	<textarea id="taskScript">{{ .Script }}</textarea>
	<hr/>
	<button class="btn" id="save-changes">Save</button>
{{ end }}

{{ define "bottom" }}
{{ end }}

{{ define "scripts" }}
	<script src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/2.36.0/codemirror.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/2.36.0/shell.min.js"></script>
	<script type="text/javascript">
		var editor = null;
		$(function(){
			editor = CodeMirror.fromTextArea(document.getElementById('taskScript'), {
				lineNumbers: true
			});
		});

		$('#save-changes').click(function(evt){
			evt.preventDefault();
			var script = editor.getValue();

			var ajax = $.ajax({
				url: "/tasks/{{ .Name }}",
				type: "put",
				data: {script: script}
			});

			ajax.done(function(evt){
				window.location = "/tasks"
			});
		});

		$('#delete-task').click(function(evt){
			if(!confirm("Really delete {{ .Name }}?")){
				return;
			}

			var ajax = $.ajax({
				url: "/tasks/{{ .Name }}",
				type: "delete"
			});

			ajax.done(function(){
				window.location = "/tasks";
			})
		});
	</script>
{{ end }}