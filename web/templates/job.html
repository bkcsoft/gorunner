{{ define "title" }}{{ .Name }} | gorunner{{ end }}

{{ define "head" }}
{{end}}

{{ define "navigation" }}
	<li class="nav-header">Navigation</li>
	<li class="active"><a href="/jobs">Jobs</a></li>
	<li><a href="/tasks">Tasks</a></li>
	<li class="nav-header">Actions</li>
	<li><a href="#bind-task" role="button" data-toggle="modal">Bind Task</a></li>
	<li><a href="#" onclick="return confirm('Delete?')">Delete Job</a></li>
{{ end }}

{{ define "content" }}
	<h1>{{ .Name }}</h1>
	{{ if .Tasks }}
		<p>The following Tasks are defined for this job:</p>
		<ul>
		{{ range .Tasks }}
			<li>{{ .Name }}</li>
		{{ end }}
		</ul>
	{{ else }}
		<p>There are no Tasks defined for this job.</p>
	{{ end }}
{{ end }}

{{ define "bottom" }}
<div id="bind-task" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
		<h3 id="myModalLabel">Bind Task</h3>
	</div>
	<div class="modal-body">
		<p>Select a task from the list to bind to this Job.</p>
		<form name="bind-task" action="/tasks/{{ .Name }}" method="post">
			<label for="task">Available Tasks</label>
			<select name="task" id="task"></select>
		</form>
	</div>
	<div class="modal-footer">
		<button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
		<button class="btn btn-primary" data-dismiss="modal" id="bind">Add</button>
	</div>
</div>
{{ end }}

{{ define "scripts" }}
<script type="text/javascript">
	var ajax = $.ajax({
		url: "/tasks",
		dataType: "json"
	});

	ajax.done(function (data, status, jqxhr){
		var tasks = JSON.parse(jqxhr.responseText);
		var option = $('<option>');
		var options = [];
		$.each(tasks, function(i, v){
			options.push(option.clone().attr('value', v.Name).text(v.Name))
		});
		$('#task').append(options);
	});

	$('#bind').click(function(evt){
		var task = $("#task").find(":selected").val();
		var ajax = $.ajax({
			url: '/jobs/{{ .Name }}',
			type: "post",
			data: "task=" + task
		});

		ajax.done(function(){
			window.location.reload();
		});
	});
</script>
{{ end }}